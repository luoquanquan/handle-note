<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.2.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicon-1.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-1.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-1.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:new URL("http://note.niubishanshan.top").hostname,root:"/",scheme:"Gemini",version:"7.7.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!1,show_result:!1,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},path:"search.json",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="安装1brew install nginx  安装成功后 nginx 的位置在 &#x2F;usr&#x2F;local&#x2F;etc&#x2F;nginx 目录下. 启动1nginx  运行 nginx 命令没有报错说明安装启动成功, 验证方式为浏览器直接访问 localhost 查看是否成功展示 nginx 欢迎页面"><meta property="og:type" content="article"><meta property="og:title" content="HTTP 实践"><meta property="og:url" content="http://note.niubishanshan.top/%E5%89%8D%E7%AB%AF/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/HTTP/HTTP%20%E5%AE%9E%E8%B7%B5/index.html"><meta property="og:site_name" content="圈圈的随手笔记"><meta property="og:description" content="安装1brew install nginx  安装成功后 nginx 的位置在 &#x2F;usr&#x2F;local&#x2F;etc&#x2F;nginx 目录下. 启动1nginx  运行 nginx 命令没有报错说明安装启动成功, 验证方式为浏览器直接访问 localhost 查看是否成功展示 nginx 欢迎页面"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="/note-images/2020-03-05-15-58-30.png"><meta property="article:published_time" content="2020-03-05T03:50:31.000Z"><meta property="article:modified_time" content="2020-03-08T09:19:36.429Z"><meta property="article:author" content="圈圈的圈"><meta property="article:tag" content="HTTP"><meta property="article:tag" content="nginx"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="/note-images/2020-03-05-15-58-30.png"><link rel="canonical" href="http://note.niubishanshan.top/%E5%89%8D%E7%AB%AF/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/HTTP/HTTP%20%E5%AE%9E%E8%B7%B5/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>HTTP 实践 | 圈圈的随手笔记</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="圈圈的随手笔记" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div> <a href="https://github.com/luoquanquan" target="_blank" rel="noopener" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">圈圈的随手笔记</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">路漫漫其修远兮, 吾将上下而求索</p></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://note.niubishanshan.top/%E5%89%8D%E7%AB%AF/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/HTTP/HTTP%20%E5%AE%9E%E8%B7%B5/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpeg"><meta itemprop="name" content="圈圈的圈"><meta itemprop="description" content="技术学习, 读书笔记, 生活感悟~"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="圈圈的随手笔记"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> HTTP 实践</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2020-03-05 11:50:31" itemprop="dateCreated datePublished" datetime="2020-03-05T11:50:31+08:00">2020-03-05</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-03-08 17:19:36" itemprop="dateModified" datetime="2020-03-08T17:19:36+08:00">2020-03-08</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a></span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>3.5k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span>3 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install nginx</span><br></pre></td></tr></table></figure><p>安装成功后 <code>nginx</code> 的位置在 <code>/usr/local/etc/nginx</code> 目录下.</p><h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx</span><br></pre></td></tr></table></figure><p>运行 <code>nginx</code> 命令没有报错说明安装启动成功, 验证方式为浏览器直接访问 <a href="http://localhost" target="_blank" rel="noopener">localhost</a> 查看是否成功展示 <code>nginx</code> 欢迎页面</p><a id="more"></a><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><blockquote><p>正式线上配置的 nginx 需要配置 DNS 来把域名指向我们的服务器 IP. 由于本地开发, 直接修改 hosts 即可</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">12.0.0.1 quanquan.com</span><br></pre></td></tr></table></figure><p>PS: 每次修改配置文件以后都要执行 <code>nginx -s reload</code> 重启 <code>nginx</code></p><h3 id="导入额外配置文件"><a href="#导入额外配置文件" class="headerlink" title="导入额外配置文件"></a>导入额外配置文件</h3><p>安装 <code>nginx</code> 成功后, 其配置文件的默认配置文件为 <code>/usr/local/etc/nginx/nginx.conf</code> 文件,<br>打开配置文件, 取消 <code>include servers/*;</code> 这一行前边的注释, 就可以随意在 <code>servers</code> 目录下创建配置文件了. 本次笔记中只创建 <code>test.conf</code> 配置文件</p><h3 id="配置一个简单的代理服务器"><a href="#配置一个简单的代理服务器" class="headerlink" title="配置一个简单的代理服务器"></a>配置一个简单的代理服务器</h3><p>编写 nginx 配置文件如下</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> quanquan.com;</span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://127.0.0.1:3333;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>创建一个 <code>server</code> 文件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function">(<span class="params">request, response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(request.headers);</span><br><span class="line">    response.end(<span class="string">'&lt;h1&gt;Hello world&lt;h1&gt;'</span>)</span><br><span class="line">&#125;).listen(<span class="number">3333</span>, () =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'the server is running~'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>服务文件中, 对于所有的请求直接返回了 <code>&lt;h1&gt;Hello world&lt;h1&gt;</code>, 并且打印了请求的头信息, 可以看到以上的代理服务虽然能够成功代理到业务服务但是打印的 HOST 头信息, 变成了代理服务请求的 HOST: 127.0.0.1:3333</p><h3 id="修正-HOST-头信息"><a href="#修正-HOST-头信息" class="headerlink" title="修正 HOST 头信息"></a>修正 HOST 头信息</h3><p>把 location 块修改为以下内容即可</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">location &#x2F; &#123;</span><br><span class="line">    proxy_pass http:&#x2F;&#x2F;127.0.0.1:3333;</span><br><span class="line">    proxy_set_header Host $host;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h3 id="配置代理缓存服务器"><a href="#配置代理缓存服务器" class="headerlink" title="配置代理缓存服务器"></a>配置代理缓存服务器</h3><p>第一步, 指定缓存信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxy_cache_path &#x2F;Users&#x2F;quanquanluo&#x2F;nginx_cache levels&#x3D;1:2 keys_zone&#x3D;cache:10m max_size&#x3D;10g inactive&#x3D;60m use_temp_path&#x3D;off;</span><br></pre></td></tr></table></figure><p>在此步骤中我们指定了, nginx 缓存的目录重启 nginx 之后会在指定的缓存目录创建一个</p><p>第二步, 把 location 块修改为以下内容即可</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">location &#x2F; &#123;</span><br><span class="line">    proxy_cache my_cache;</span><br><span class="line">    proxy_pass http:&#x2F;&#x2F;127.0.0.1:3333;</span><br><span class="line">    proxy_set_header Host $host;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>第三步, 升级 <code>server.js</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="keyword">const</span> sleep = <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> resolve(), <span class="number">2e3</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> img = fs.readFileSync(<span class="string">'./test.jpg'</span>)</span><br><span class="line"></span><br><span class="line">http.createServer(<span class="keyword">async</span> (request, response) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;url&#125; = request</span><br><span class="line">    <span class="built_in">console</span>.log(url);</span><br><span class="line">    <span class="keyword">if</span> (url === <span class="string">'/'</span>) &#123;</span><br><span class="line">        response.end(<span class="string">'&lt;h1&gt;Hello world&lt;h1&gt;&lt;img src="/test.jpg" /&gt;'</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (url === <span class="string">'/test.jpg'</span>) &#123;</span><br><span class="line">        <span class="keyword">await</span> sleep()</span><br><span class="line">        response.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line">            <span class="string">'Content-Type'</span>: <span class="string">'image/jpeg'</span>,</span><br><span class="line">            <span class="string">'Cache-Control'</span>: <span class="string">'max-age=5, s-maxage=10'</span></span><br><span class="line">        &#125;)</span><br><span class="line">        response.end(img)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    response.end()</span><br><span class="line">&#125;).listen(<span class="number">3333</span>, () =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'the server is running~'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>第四步, 通过 Vary 字段可以指定只有某个请求头一致的时候才能使用缓存</p><p>示例,</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">response.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line">    <span class="string">'Content-Type'</span>: <span class="string">'image/jpeg'</span>,</span><br><span class="line">    <span class="string">'Cache-Control'</span>: <span class="string">'max-age=5, s-maxage=10'</span>,</span><br><span class="line">    Vary: <span class="string">'User-Agent'</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>以上配置指定了只有请求头 <code>User-Agent</code> 一致的时候才能使用缓存. 这个的使用场景就是为相同的终端提供一致的缓存信息</p><h3 id="在本地配置-https-服务"><a href="#在本地配置-https-服务" class="headerlink" title="在本地配置 https 服务"></a>在本地配置 https 服务</h3><p>第一步, 生成证书.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl req -x509 -newkey rsa:2048 -nodes -sha256 -keyout localhost-privkey.pem -out localhost-cert.pem</span><br></pre></td></tr></table></figure><p>执行该步骤后, 会在当前目录创建 <code>localhost-privkey.pem</code> <code>localhost-cert.pem</code> 两个文件</p><p>第二步, 修改配置爱文件中的 server 块</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl;</span><br><span class="line">    <span class="attribute">server_name</span> quanquan.com;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">ssl_certificate_key</span>    path to /localhost-privkey.pem;</span><br><span class="line">    <span class="attribute">ssl_certificate</span>        path to /localhost-cert.pem;</span><br><span class="line">    ....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>新版的 chrome 中, 自建的证书, 没有了不安全页面的继续访问入口. 所以有了下一步</p><p>第三步, 安装并信任刚刚创建的证书</p><ul><li>在 finder 中找到生成的 localhost-cert.pem 文件并双击</li><li>在钥匙串登录类别中找到创建证书时候输入的证书名字, 我写的是 CN</li><li>双击刚刚安装的证书弹出以下图片, 按照图示设置</li></ul><p><img src="/note-images/2020-03-05-15-58-30.png" alt="2020-03-05-15-58-30"></p><p>至此, 再通过 https 访问 <code>quanquan.com</code> 弹出的不安全页面就可以通过高级, 选择仍要前往了. 本地配置 https 环境完成</p><h3 id="访问-http-自动跳转到-https"><a href="#访问-http-自动跳转到-https" class="headerlink" title="访问 http 自动跳转到 https"></a>访问 http 自动跳转到 https</h3><p>在配置文件中添加以下配置即可</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">  <span class="attribute">listen</span> <span class="number">80</span> default_server;</span><br><span class="line">  <span class="attribute">listen</span> [::]:<span class="number">80</span> default_server;</span><br><span class="line">  <span class="attribute">server_name</span> quanquan.com;</span><br><span class="line">  <span class="attribute">return</span> <span class="number">302</span> https://<span class="variable">$server_name</span><span class="variable">$request_uri</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="升级-http2"><a href="#升级-http2" class="headerlink" title="升级 http2"></a>升级 http2</h3><p>就这么一句</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">listen</span> <span class="number">443</span> http2 ssl;</span><br></pre></td></tr></table></figure><h3 id="开启-http2-Server-Push"><a href="#开启-http2-Server-Push" class="headerlink" title="开启 http2 Server-Push"></a>开启 http2 Server-Push</h3><p>第一步, nginx 配置文件 <code>server</code> 块中添加 <code>http2_push_preload on;</code><br>第二步, 升级服务代码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">if</span> (url === <span class="string">'/'</span>) &#123;</span><br><span class="line">    response.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line">        <span class="string">'Link'</span>: <span class="string">'&lt;/test.jpg&gt;; rel=preload; as=image'</span></span><br><span class="line">    &#125;)</span><br><span class="line">    response.end(<span class="string">'&lt;h1&gt;Hello world&lt;h1&gt;&lt;img src="/test.jpg" /&gt;'</span>)</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>以上代码的意思是当浏览器访问 <code>/</code> 路径时, 主动向浏览器推送 test.jpg</p><p>由于, 自签名的证书构建的 https 会被浏览器标记为不安全的服务, 所以浏览器上看不到效果…</p><p>但是这个语法是没有问题的~</p><h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><p><a href="http://www.ruanyifeng.com/blog/2018/03/http2_server_push.html" target="_blank" rel="noopener">HTTP/2 服务器推送（Server Push）教程</a><br><a href="https://www.cnblogs.com/wujiaolong/p/5172e1f7e9924644172b64cb2c41fc58.html" target="_blank" rel="noopener">HTTP、HTTP2.0、SPDY、HTTPS 你应该知道的一些事</a></p></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/HTTP/" rel="tag"># HTTP</a> <a href="/tags/nginx/" rel="tag"># nginx</a></div><div class="post-nav"><div class="post-nav-item"><a href="/%E5%89%8D%E7%AB%AF/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/HTTP/HTTP%20%E5%9F%BA%E7%A1%80/" rel="prev" title="HTTP 基础"><i class="fa fa-chevron-left"></i> HTTP 基础</a></div><div class="post-nav-item"> <a href="/%E5%89%8D%E7%AB%AF/interview/interview-4/" rel="next" title="interview-4">interview-4<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#安装"><span class="nav-text">安装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#启动"><span class="nav-text">启动</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置"><span class="nav-text">配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#导入额外配置文件"><span class="nav-text">导入额外配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置一个简单的代理服务器"><span class="nav-text">配置一个简单的代理服务器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#修正-HOST-头信息"><span class="nav-text">修正 HOST 头信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置代理缓存服务器"><span class="nav-text">配置代理缓存服务器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#在本地配置-https-服务"><span class="nav-text">在本地配置 https 服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#访问-http-自动跳转到-https"><span class="nav-text">访问 http 自动跳转到 https</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#升级-http2"><span class="nav-text">升级 http2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#开启-http2-Server-Push"><span class="nav-text">开启 http2 Server-Push</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考文章"><span class="nav-text">参考文章</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="圈圈的圈" src="/images/avatar.jpeg"><p class="site-author-name" itemprop="name">圈圈的圈</p><div class="site-description" itemprop="description">技术学习, 读书笔记, 生活感悟~</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">44</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">7</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">26</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://juejin.im/user/5837c2bd61ff4b006ca8d1b2" title="掘金 → https:&#x2F;&#x2F;juejin.im&#x2F;user&#x2F;5837c2bd61ff4b006ca8d1b2" rel="noopener" target="_blank"><i class="fa fa-fw fa-stack-overflow"></i> 掘金</a></span><span class="links-of-author-item"><a href="https://github.com/luoquanquan" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;luoquanquan" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:luo_quanquan@163.com" title="E-Mail → mailto:luo_quanquan@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-fw fa-rss"></i> RSS</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="beian"><a href="http://www.beian.miit.gov.cn/" rel="noopener" target="_blank">京ICP备17034706号-1</a></div><div class="copyright"> &copy; <span itemprop="copyrightYear">2020</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">圈圈的圈</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-area-chart"></i></span> <span title="站点总字数">61k</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span title="站点阅读时长">55 分钟</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer></div><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/js/theme-next-canvas-nest/canvas-nest.min.js"></script><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script></body></html>