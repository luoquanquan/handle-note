---
title: HTTP
date: 2020-03-04 18:50:31
categories:
  - 前端
tags:
  - HTTP
  - nginx
---

![2020-03-04-20-55-42](http://handle-note-img.niubishanshan.top/2020-03-04-20-55-42.png)

## 概念

HTTP (HyperText Transfer Protocol): 超文本传输协议, 它是建立在 TCP/IP 协议之上的应用层规范. 是互联网上应用最广泛的一种网络协议.

## HTTP 5 层网络模型

![2020-03-04-20-46-44](http://handle-note-img.niubishanshan.top/2020-03-04-20-46-44.png)

各个层级概述
- 物理层, 主要作用是定义物理设备如何连接和传输数据
- 数据链路层, 在通信实体间建立数据链路链接
- 网络层, 为数据在节点之间传输创建逻辑链路
- 传输层, 用于向用户提供端到端(end to end)的服务. 传输层向上层屏蔽了下层数据通信的细节. 例如, 包体过大时的分包问题.
- 应用层, 为软件提供服务, 构建与 TCP 协议之上, 向应用软件屏蔽了网络传输相关的细节

## HTTP 的发展历史

![2020-03-04-20-58-06](http://handle-note-img.niubishanshan.top/2020-03-04-20-58-06.png)

### HTTP / 0.9

发布于 1991 年, 该版本极其简单.
- 只有一个命令 GET
- 没有 HEADER 等描述数据的信息
- 服务端内容发送完成之后就关闭 TCP 链接

### HTTP / 1.0

- 任何格式的内容都可以发送, 使得互联网不仅能传递文字还能传输图片 / 视频 / 二进制文件, 为互联网的大发展奠定了基础
- 增加了 POST / PUT / HEADER 等命令
- 增加了 status code 和 header 相关内容.
- 增加了多字符集的支持, 多部分发送(multi-part), 权限(authorization), 缓存(cache), 内容编码(content encoding)等

HTTP / 1.0 的缺点, 就是每个 TCP 链接只能发送一个请求. 数据发送完毕就会断开 TCP 链接, 如果需要请求其他资源就需要重新创建 TCP 链接

### HTTP / 1.1

- 持久链接, 设置 TCP 链接在数据发送完成后默认不关闭, 可以被后续的请求复用. 解决了 1.0 版本中的问题. 客户端或者服务端发现对方一段时间没有活动就可以主动关闭链接. 规范的做法是, 客户端在最后一个请求时发送`Connection: close` 明确通知服务器关闭 TCP 链接
- 增加了管道机制, 可以在一个 TCP 链接里发送多个 http 请求, 但是在 1.1 版本中虽然可以在同一个 TCP 链接里发送多个 http 请求, 但是服务器对于进来的请求时按照顺序进行数据返回的. 如果前一个请求等待时间非常长, 而后一个请求处理得比较快. 这个时候后一个请求不能先发送, 而是要等第一个请求数据全部发送完成之后, 才能进行发送. 即是串行的.
- 增加了 HOST 头, 有了 HOST 之后就可以在一台服务器(物理机)上同时跑多个 web 服务, 提升了物理机的利用率

### HTTP / 2

- 所有数据都以二进制传输, 在 HTTP/1.1 里面大部分的数据传输是通过字符串, 所以数据的分片方式是不太一样的. 在 HTTP/2 里面所有的数据都是以帧进行传输的
- 同一个连接里面发送多个请求时, 服务器端不再需要按照顺序来返回处理后的数据. 而是可以在返回第一个请求里面数据的时候, 同时返回第二个请求里面的数据. 这样的并行传输能够更大限度地提高 web 应用的传输效率
- 新增头信息压缩, 有效减少带宽使用
- 新增推送等功能, HTTP/2之前, 只能由客户端发送数据, 服务器端返回数据. 客户端是主动方, 服务器端永远是被动方. 在 HTTP/2 里面有了 "推送" 的概念, 也就是说服务器端可以主动向客户端发起一些数据传输
- HTTP/2 其实主要就是改善了 HTTP/1.1 里面造成性能低下的一些问题

推送功能实例, 一个web页面加载时会要求一些html, css, js等文件, css和js文件是以链接的形式在 html 文本里面显示的, 只有通过浏览器解析了 html 里面的内容之后, 才能根据链接里面包含的URL地址去请求对应的 css 和 js 文件.
在HTTP/2之前, 这个传输过程会包含顺序问题, 需要先请求到 html 的文件, 通过浏览器运行解析这个 html 文件之后, 才能去发送 css 的请求和 js 的请求.
HTTP/2 中有了推送功能之后, 在请求 html 的同时, 服务器端可以主动把 html 里面所引用到的 css 和 js 文件推送到客户端, 这样html, css 和 js 的发送就是并行的而不是串行的
